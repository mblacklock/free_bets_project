<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Javascript tests</title>
  <link rel="stylesheet" href="qunit-2.6.1.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture">
  
	<div class="has-error" hidden>Error text</div>
	<table name="bookie-summary">
		<tr data-id="1">
			<td>Bet365</td>
			<td>25</td> 
			<td id='username'>
				<input class="input" placeholder="username" />
				<p class="text" hidden></p>
				<button class="edit btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='status'>
				<select class="status">
					<option value="signup">Signup</option>
					<option value="deposit">Deposit</option>
					<option value="initial">Initial Bet</option>
					<option value="free">Free Bet</option>
					<option value="complete">Complete</option>
				</select>
			</td>
			<td id='balance'>
				<input class="input" />
				<p class="text" hidden></p>
				<button class="edit" class="btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='profit'>
				<input class="input" />
				<p class="text" hidden></p>
				<button class="edit" class="btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='banked'>
				<input type="checkbox" class="banked" />
			</td>
		</tr>
		<tr data-id="2">
			<td>Bet365</td>
			<td>25</td> 
			<td id='username'>
				<input class="input" placeholder="username" />
				<p class="text" hidden></p>
				<button class="edit btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='status'>
				<select class="status">
					<option value="signup">Signup</option>
					<option value="deposit">Deposit</option>
					<option value="initial">Initial Bet</option>
					<option value="free">Free Bet</option>
					<option value="complete">Complete</option>
				</select>
			</td>
			<td id='balance'>
				<input class="input" />
				<p class="text" hidden></p>
				<button class="edit" class="btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='profit'>
				<input class="input" />
				<p class="text" hidden></p>
				<button class="edit" class="btn btn-primary btn-sm" type="button" hidden>
					edit
				</button>
			</td>
			<td id='banked'>
				<input type="checkbox" class="banked" />
			</td>
		</tr>
	</table>
	
  </div>
  
  <script src="../jquery-3.3.1.min.js"></script>
  <script src="../summary.js"></script>
  <script src="../summary-ajax.js"></script>
  <script src="qunit-2.6.1.js"></script>

  <script>

console.log('qunit tests start');

QUnit.test("smoke test", function (assert) {
  assert.equal(1, 1, "Maths works!");
});

QUnit.test("username box should be hidden on enter", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #username .input").is(':visible'), false);
});

QUnit.test("username box should NOT be hidden on any other keypress", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 12; // # Some key code value
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #username .input").is(':visible'), true);
});

QUnit.test("username text should be visible on enter", function (assert) {
	window.BetsSummary.initialize();
	$("#username .text").hide();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #username .text").is(':visible'), true);
});

QUnit.test("username text should update on enter", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #username .input").val('testuser');
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #username .text").text(), 'testuser');
});

QUnit.test("username edit button should be visible on enter", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #username .edit").is(':visible'), true);
});

QUnit.test("username edit button should be hidden when clicked", function (assert) {
	window.BetsSummary.initialize();
	$("tr[data-id='1'] #username .edit").show();
	$("tr[data-id='1'] #username .edit").click();
	
	assert.equal($("tr[data-id='1'] #username .edit").is(':visible'), false);
});

QUnit.test("username text should be hidden when edit btn clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .text").show();
	$("tr[data-id='1'] #username .edit").click();
	
	assert.equal($("tr[data-id='1'] #username .text").is(':visible'), false);
});

QUnit.test("username box should be visible when edit btn clicked", function (assert) {
	window.BetsSummary.initialize();
	$("tr[data-id='1'] #username .input").hide();	
	$("tr[data-id='1'] #username .edit").click();
	
	assert.equal($("tr[data-id='1'] #username .input").is(':visible'), true);
});

QUnit.test("username box should contain existing username when edit btn clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .text").text('testuser');
	$("tr[data-id='1'] #username .edit").click();
	
	assert.equal($("tr[data-id='1'] #username .input").attr('placeholder'), 'testuser');
});

QUnit.test("username 1 box should NOT affect 2", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #username .input").val('testuser');
	$("tr[data-id='1'] #username .input").trigger(e);
	
	assert.notEqual($("tr[data-id='2'] #username .text").text(), 'testuser');
	assert.equal($("tr[data-id='2'] #username .input").is(':visible'), true);
	assert.equal($("tr[data-id='2'] #username .text").is(':visible'), false);
	assert.equal($("tr[data-id='2'] #username .edit").is(':visible'), false);
	
});

QUnit.test("username 1 edit button click does not affect 2", function (assert) {
	window.BetsSummary.initialize();
	$("tr[data-id='1'] #username .text").text('testuser');
	$("tr[data-id='1'] #username .edit").click();
	
	assert.notEqual($("tr[data-id='2'] #username .input").attr('placeholder'), 'testuser');
	
});

QUnit.test("balance box should be hidden on enter", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # Some key code value
	$("tr[data-id='1'] #balance .input").val('13');
	$("tr[data-id='1'] #balance .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #balance .input").is(':visible'), false);
});

QUnit.test("edit buttons disabled when banked clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .edit").show();
	$("tr[data-id='1'] #profit .edit").show();
	$("tr[data-id='1'] #balance .edit").show();
	
	$("tr[data-id='1'] .banked").click();
	
	assert.equal($("tr[data-id='1'] .banked").is(':checked'), true);
	assert.equal($("tr[data-id='1'] #username .edit").is(':disabled'), true);
	assert.equal($("tr[data-id='1'] #balance .edit").is(':disabled'), true);
	assert.equal($("tr[data-id='1'] #profit .edit").is(':disabled'), true);
});

QUnit.test("input boxes disabled when banked clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .input").show();
	$("tr[data-id='1'] #profit .input").show();
	$("tr[data-id='1'] #balance .input").show();
	
	$("tr[data-id='1'] .banked").click();
	
	assert.equal($("tr[data-id='1'] #username .input").is(':disabled'), true);
	assert.equal($("tr[data-id='1'] #balance .input").is(':disabled'), true);
	assert.equal($("tr[data-id='1'] #profit .input").is(':disabled'), true);
});

QUnit.test("status dropdown disabled when banked clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #status .status").show();
	
	$("tr[data-id='1'] .banked").click();
	
	assert.equal($("tr[data-id='1'] #status .status").is(':disabled'), true);
});

QUnit.test("other rows not affected when banked clicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .input").show();
	$("tr[data-id='2'] #username .input").show();
	
	$("tr[data-id='1'] .banked").click();
	
	assert.equal($("tr[data-id='1'] #username .input").is(':disabled'), true);
	assert.equal($("tr[data-id='2'] #username .input").is(':disabled'), false);
});

QUnit.test("edit buttons reenabled when banked unclicked", function (assert) {
	window.BetsSummary.initialize();	
	$("tr[data-id='1'] #username .edit").prop('enabled', false);
	$("tr[data-id='1'] #profit .edit").prop('enabled', false);
	$("tr[data-id='1'] #balance .edit").prop('enabled', false);
	$("tr[data-id='1'] .banked").prop('checked', true);
	
	$("tr[data-id='1'] .banked").click();
	
	assert.equal($("tr[data-id='1'] .banked").is(':checked'), false);
	assert.equal($("tr[data-id='1'] #username .edit").is(':enabled'), true);
	assert.equal($("tr[data-id='1'] #balance .edit").is(':enabled'), true);
	assert.equal($("tr[data-id='1'] #profit .edit").is(':enabled'), true);
});

QUnit.test("error thrown if balance or profit non-numeric", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # 
	$("tr[data-id='1'] #profit .input").val('A');
	$("tr[data-id='1'] #profit .input").trigger(e);
	
	assert.equal($('.has-error').is(':visible'), true);
});

QUnit.test("input box stays visible if balance or profit non-numeric", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # 
	$("tr[data-id='1'] #balance .input").val('A');
	$("tr[data-id='1'] #balance .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #balance .input").is(':visible'), true);
});

QUnit.test("text label stays hidden if balance or profit non-numeric", function (assert) {
	window.BetsSummary.initialize();
	var e = jQuery.Event("keypress");
	e.which = 13; // # 
	$("tr[data-id='1'] #balance .input").val('A');
	$("tr[data-id='1'] #balance .input").trigger(e);
	
	assert.equal($("tr[data-id='1'] #balance .text").is(':visible'), false);
});

QUnit.test("errors should be hidden if successfully submitted", function (assert) {
	window.BetsSummary.initialize();
	$('.has-error').show();
	var e = jQuery.Event("keypress");
	e.which = 13; // # 
	$("tr[data-id='1'] #balance .input").val('123');
	$("tr[data-id='1'] #balance .input").trigger(e); 
	assert.equal($('.has-error').is(':visible'), false);
});

  </script>
</body>
</html>