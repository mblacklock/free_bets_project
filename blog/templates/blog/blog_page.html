{% extends "base.html" %}
{% load staticfiles %}
{% load comments static %}
{% load wagtailcore_tags wagtailimages_tags %}


{% block css %}
	<link rel="stylesheet" type="text/css" href="{% static 'fluent_comments/css/ajaxcomments.css' %}" />
    <link href="{% static 'comment.css' %}" rel="stylesheet">
{% endblock %}
	
{% block body_class %}template-blogpage{% endblock %}

{% block body %}
    <h1>{{ page.title }}</h1>
    <p class="meta">{{ page.date }}</p>
	
	{% with categories=page.categories.all %}
		{% if categories %}
			<h3>Posted in:</h3>
			<ul>
				{% for category in categories %}
					<li style="display: inline">
						{% image category.icon fill-32x32 style="vertical-align: middle" %}
						{{ category.name }}
					</li>
				{% endfor %}
			</ul>
		{% endif %}
	{% endwith %}

    <div class="intro">{{ page.intro }}</div>

    {% with blocks=self.body %}
		{% for block in blocks %}
			{% if block.block_type == 'heading' %}
				<h2>{{ block.value }}</h2>
			{% else %}
			   <section class="block-{{ block.block_type }}">
				   {{ block }}
			   </section>
			{% endif %}
		{% endfor %}
	{% endwith %}
	
	{% for item in page.gallery_images.all %}
        <div style="float: left; margin: 10px">
            {% image item.image fill-320x240 %}
            <p>{{ item.caption }}</p>
        </div>
    {% endfor %}
	
	{% if page.tags.all.count %}
		<div class="tags">
			<h3>Tags</h3>
			{% for tag in page.tags.all %}
				<a href="{% slugurl 'tags' %}?tag={{ tag }}"><button type="button">{{ tag }}</button></a>
			{% endfor %}
		</div>
	{% endif %}
	{% get_comment_count for page as comment_count %}
	<div class='form-inline col-8 offset-2 pt-4'>
		<h4 class='col-2'>Comments</h4>
		<h5 class='col-4 offset-6'>{{ comment_count }} comments</h5>
	</div>
	<ul class="list-group list-group-flush col-8 offset-2 my-3">
		{% render_comment_list for page %}
	</ul>
	<h4 class='offset-2 py-2'>Leave a comment</h4>
	{% render_comment_form for page %}

    <p><a href="{{ page.get_parent.url }}">Return to blog</a></p>

{% endblock %}

{% block scripts %}
	<script type="text/javascript" src="{% static 'fluent_comments/js/ajaxcomments.js' %}"></script>
{% endblock %}